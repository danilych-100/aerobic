<div class="tab_div">
    <div class="tabs_menu" style="margin-right: 30px">
        <ul class="tabs">
            <li id="tab1" (click)="openTab(1)" class="active" style="border-top: 1px solid rgba(10, 11, 49, 0.2)"><a>Заявки</a>
            </li>
            <li id="tab2" (click)="openTab(2)" style="border-bottom: 1px solid rgba(10, 11, 49, 0.2)">
                <a>Пользователи</a></li>
        </ul>
    </div>
</div>

<div class="tab_content_admin">
    <div id="tabContent_1" style="display: none">
        <div>
            <mat-form-field style="width: 200px;">
                <mat-select placeholder="Субъект РФ" [(ngModel)]="selectingRegion">
                    <mat-option *ngFor="let reg of regions" [value]="reg" (onSelectionChange)="applyFilterByName($event, reg, 'region')">
                        {{reg}}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <a (click)="removeFilterByName('region');selectingRegion = null; " style="cursor: pointer">
                <mat-icon class="remove-icon" *ngIf="selectingRegion">clear</mat-icon>
            </a>
        </div>

        <div>
            <mat-form-field style="width: 200px;">
                <mat-select placeholder="Возрастная категория" [(ngModel)]="selectingCategory">
                    <mat-option *ngFor="let cat of categories" [value]="cat" (onSelectionChange)="applyFilterByName($event, cat, 'ageCategory')">
                        {{cat}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <a (click)="removeFilterByName('ageCategory');selectingCategory = null; " style="cursor: pointer">
                <mat-icon class="remove-icon" *ngIf="selectingCategory">clear</mat-icon>
            </a>

        </div>

        <div>
            <mat-form-field style="width: 200px;">
                <mat-select placeholder="Номинация" [(ngModel)]="selectingNominations">
                    <mat-option *ngFor="let nom of nominations" [value]="nom" (onSelectionChange)="applyFilterByName($event, nom, 'nomination')">
                        {{nom}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <a (click)="removeFilterByName('nomination');selectingNominations = null; " style="cursor: pointer">
                <mat-icon class="remove-icon" *ngIf="selectingNominations">clear</mat-icon>
            </a>


            <mat-form-field style="float: right;">
                <input matInput (keyup)="applyFilterByName($event, $event.target.value, 'commandName')" placeholder="Поиск заявки">
            </mat-form-field>

        </div>
        <div>
            <button mat-stroked-button color="primary" (click)="downloadExcelReport()">Скачать отчет в excel</button>

            <button mat-stroked-button color="primary"
                    (click)="downloadAllRequestsFilteredMusic()"
                    style="float: right;width: 182px; margin-bottom: 10px;"
                    matTooltip="Чтобы иземенить папку для скачивания, в браузере Google Chrome перейдите Настройки -> Дополнительные -> Скачанные Файлы.
                    Измените папку, либо выберете опцию 'Всегда указывать место для скачивания'

                    Лучше отфильтровать данные, чтобы не было долгой загрузки всех музыкальных файлов."
                    [matTooltipDisabled] = "false"
                    [matTooltipPosition]="'above'"
                    matTooltipClass="tooltip-bigger">Скачать всю музыку</button>
        </div>



        <div>
            <div *ngIf="isLoadingResults" class="example-loading-shade">
                <mat-spinner *ngIf="isLoadingResults"></mat-spinner>
            </div>

            <table mat-table [dataSource]="dataSource" class="cars-table mat-elevation-z8"  [ngClass]="{'loaded-table': isLoadingResults}" (matSortChange)="sortData($event)" #reqSort="matSort"
                   matSort>

                <ng-container matColumnDef="commandName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Название команды</th>
                    <td mat-cell *matCellDef="let row"  (mousedown)="saveClickTime()" (mouseup)="selectRow(row)">{{row.commandName}}</td>
                </ng-container>

                <ng-container matColumnDef="region">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Субъект РФ</th>
                    <td mat-cell *matCellDef="let row"  (mousedown)="saveClickTime()" (mouseup)="selectRow(row)">{{row.region}}</td>
                </ng-container>

                <!-- Title Column -->
                <ng-container matColumnDef="ageCategory">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Возрастная категория</th>
                    <td mat-cell *matCellDef="let row" (mousedown)="saveClickTime()" (mouseup)="selectRow(row)">{{row.ageCategory}}</td>
                </ng-container>

                <!-- State Column -->
                <ng-container matColumnDef="nominations">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Номинация</th>
                    <td mat-cell *matCellDef="let row"  (mousedown)="saveClickTime()" (mouseup)="selectRow(row)">{{row.nomination}}</td>
                </ng-container>

                <!-- Created Column -->
                <ng-container matColumnDef="musicFileName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>
                        Музыкальный файл
                    </th>
                    <td mat-cell *matCellDef="let row">
                        <span style="color: blue; text-decoration: underline; cursor: pointer;" (click)="downloadMusicFile(row)" *ngIf="row.musicFileName">{{row.musicFileName}}</span>
                        <span *ngIf="!row.musicFileName">Не загружен</span>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="request-table-row"></tr>
            </table>

            <mat-paginator [length]="resultsLength"  [ngClass]="{'loaded-pager': isLoadingResults}"
                           [pageSize]="10"></mat-paginator>
        </div>

        <div>
            <button mat-stroked-button color="primary" (click)="downloadRequestsToJson()">Скачать данные в json</button>
        </div>
    </div>
    <div id="tabContent_2" style="display: none">
        <mat-form-field style="float: right;min-width: 240px;">
            <input matInput (keyup)="applyUsersFilterByName($event, $event.target.value, 'name')" placeholder="Поиск пользователя">
        </mat-form-field>

        <div>
            <mat-form-field style="width: 200px;">
                <mat-select placeholder="Субъект РФ" [(ngModel)]="selectingRegionUsers">
                    <mat-option *ngFor="let reg of regions" [value]="reg" (onSelectionChange)="applyUsersFilterByName($event, reg, 'region')">
                        {{reg}}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <a (click)="removeUsersFilterByName('region');selectingRegionUsers = null; " style="cursor: pointer">
                <mat-icon class="remove-icon" *ngIf="selectingRegionUsers">clear</mat-icon>
            </a>
        </div>

        <div>
            <button mat-stroked-button color="primary" (click)="downloadUserExcelReport()" style="margin-bottom: 10px">Скачать отчет в excel</button>
        </div>

        <div>
            <div *ngIf="isLoadingResultsUsers" class="example-loading-shade">
                <mat-spinner *ngIf="isLoadingResultsUsers"></mat-spinner>
            </div>

            <table mat-table #usersSort="matSort" [dataSource]="dataSourceUsers" class="cars-table mat-elevation-z8" [ngClass]="{'loaded-table': isLoadingResultsUsers}"  (matSortChange)="sortDataUsers($event)"
                   matSort>
                <!-- Number Column -->
                <ng-container matColumnDef="userName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>ФИО пользователя</th>
                    <td mat-cell *matCellDef="let row">{{row.userName}}</td>
                </ng-container>

                <ng-container matColumnDef="commandName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Название команды</th>
                    <td mat-cell *matCellDef="let row">{{row.commandName}}</td>
                </ng-container>

                <ng-container matColumnDef="region">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Субъект РФ</th>
                    <td mat-cell *matCellDef="let row">{{row.region}}</td>
                </ng-container>

                <!-- Title Column -->
                <ng-container matColumnDef="phoneNumber">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Телефон</th>
                    <td mat-cell *matCellDef="let row">+7{{row.phoneNumber}}</td>
                </ng-container>

                <!-- State Column -->
                <ng-container matColumnDef="mail">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Почта</th>
                    <td mat-cell *matCellDef="let row">{{row.mail}}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumnsUsers"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumnsUsers;" (mousedown)="saveClickTime()" (mouseup)="selectRowUsers(row)" class="request-table-row"></tr>
            </table>

            <mat-paginator [length]="resultsLengthUsers" [ngClass]="{'loaded-table': isLoadingResultsUsers}"
                           [pageSize]="10"></mat-paginator>
    </div>
</div>


</div>

<div class="tab_div">
    <div class="tabs_menu" style="margin-right: 30px">
        <ul class="tabs">
            <li id="tab1" (click)="openTab(1)" class="active" style="border-top: 1px solid rgba(10, 11, 49, 0.2)"><a>Общая информация</a></li>
            <li id="tab2" (click)="openTab(2)"><a>Тренеры</a></li>
            <li id="tab3" (click)="openTab(3)"><a>Участники</a></li>
            <li id="tab4" (click)="openTab(4)" style="border-bottom: 1px solid rgba(10, 11, 49, 0.20)"><a>Заявки</a>
           <!-- <li id="tab5" (click)="flushCommand()" style="border-bottom: 1px solid rgba(10, 11, 49, 0.20)"><a>Сохранить</a>-->
            </li>
        </ul>
    </div>
    <div class="tab_content">
        <div id="tabContent_1" style="display: none">
            <h3>Общая информация</h3>
            <form class="example-container" [formGroup]="optionsMain" [style.fontSize.px]="getFontSize()">
                <mat-form-field [color]="optionsMain.value.color">
                    <mat-select placeholder="Субъект РФ" [(ngModel)]="command.region" required name="region"
                                [formControl]="inpRegionTeam"
                    >
                        <mat-option *ngFor="let reg of regions" [value]="reg">
                            {{reg}}
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="inpRegionTeam.invalid">{{getInpRegionTeamErrorMessage()}}</mat-error>
                </mat-form-field>
                <mat-form-field [color]="optionsMain.value.color">
                    <input matInput placeholder="Название команды" [(ngModel)]="command.name" name="name" required
                           [formControl]="inpNameTeam"
                    >
                    <mat-error *ngIf="inpNameTeam.invalid">{{getInpNameTeamErrorMessage()}}</mat-error>
                </mat-form-field>
                <mat-form-field [color]="optionsMain.value.color">
                    <input matInput placeholder="Количество участников" [(ngModel)]="command.memberCount"
                           name="memberCount"
                           [formControl]="inpMemberCountTeam"
                           required type="number" min="1">
                    <mat-error *ngIf="inpMemberCountTeam.invalid">{{getInpMemberCountTeamErrorMessage()}}</mat-error>
                </mat-form-field>
                <h5>Контакты</h5>
                <table class="example-full-width" cellspacing="0">
                    <tr>
                        <td>
                            <mat-form-field [color]="optionsMain.value.color">
                                <span matPrefix>+7 &nbsp;</span>
                                <input matInput placeholder="Номер телефона" [(ngModel)]="command.phoneNumber" required
                                       name="phoneNumber" [formControl]="phone" type="tel"
                                >
                            </mat-form-field>
                            <mat-error *ngIf="phone.invalid">{{getPhoneErrorMessage()}}</mat-error>
                        </td>
                        <td>
                            <mat-form-field [color]="optionsMain.value.color">
                                <input matInput placeholder="Электронная почта" [(ngModel)]="command.email" name="email"
                                       [formControl]="email"
                                       type="email">
                            </mat-form-field>
                            <mat-error *ngIf="email.invalid">{{getMailErrorMessage()}}</mat-error>
                        </td>
                    </tr>
                </table>
                <button mat-stroked-button color="primary" style="margin: 10px 0" (click)="flushCommand()">
                    Сохранить
                </button>
            </form>
        </div>

        <!-------------------------------Создание тренеров------------------------------------------------------------->
        <div id="tabContent_2" style="display: none">
            <h3>Добавьте тренеров</h3>
            <form class="example-container" [formGroup]="optionsCoach" [style.fontSize.px]="getFontSize()"  style="margin-bottom: 40px"
                  #coachForm="ngForm">
                <mat-form-field [color]="optionsCoach.value.color">
                    <input matInput placeholder="ФИО тренера" [(ngModel)]="currentCoach.name" name="name" required
                           [formControl]="inpNameCoach">
                    <mat-error *ngIf="inpNameCoach.invalid">{{getInpNameCoachErrorMessage()}}</mat-error>
                </mat-form-field>
                <mat-form-field [color]="optionsCoach.value.color">
                    <input matInput [matDatepicker]="picker" (focus)="picker.open()" readonly
                           placeholder="Дата рождения"
                           [max]="maxDate" [(ngModel)]="currentCoach.birthDate" [formControl]="inpDateCoach"
                           required>
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker startView="multi-year"></mat-datepicker>
                    <mat-error *ngIf="inpDateCoach.invalid">{{getInpDateCoachErrorMessage()}}</mat-error>
                </mat-form-field>
                <h5>Паспорт</h5>
                <table class="example-full-width" cellspacing="0">
                    <tr>
                        <td>
                            <mat-form-field [color]="optionsCoach.value.color">
                                <input matInput placeholder="Серия" [(ngModel)]="currentCoach.passportSeries"
                                       [formControl]="passSeries"
                                       name="passportSeries">
                            </mat-form-field>
                            <mat-error *ngIf="passSeries.invalid">{{getPassSeriesErrorMessage()}}</mat-error>
                        </td>
                        <td>
                            <mat-form-field [color]="optionsCoach.value.color">
                                <input matInput placeholder="Номер" [(ngModel)]="currentCoach.passportNumber"
                                       [formControl]="passNumber"
                                       name="passportNumber">
                            </mat-form-field>
                            <mat-error *ngIf="passNumber.invalid">{{getPassNumberErrorMessage()}}</mat-error>
                        </td>
                    </tr>
                </table>
                <mat-form-field [color]="optionsCoach.value.color">
                    <input matInput placeholder="Выдан" [(ngModel)]="currentCoach.passportDesc" name="passportDesc"
                           [formControl]="inpPassDescCoach"
                    >
                    <mat-error *ngIf="inpPassDescCoach.invalid">{{getInpPassDescCoachErrorMessage()}}</mat-error>
                </mat-form-field>
                <button mat-stroked-button color="primary"
                        [disabled]="inpNameCoach.invalid || inpDateCoach.invalid || passSeries.invalid || passNumber.invalid || inpPassDescCoach.invalid"
                        (click)="addCoach()">Добавить тренера
                </button>
            </form>

            <!-------------------------------Созданные тренеры--------------------------------------------------------->
            <div class="container" style="margin: 20px;">
                <h4>Тренеры команды</h4>
                <div *ngIf="!command.coaches.length">
                    <mat-hint>Пока тренеры не добавлены</mat-hint>
                </div>
                <div *ngIf="command.coaches.length">
                    <div *ngFor="let coach of command.coaches; let i = index" class="coach-card">
                        <mat-card>
                            <mat-card-header>
                                <mat-card-title>Тренер: {{coach.name}}</mat-card-title>
                                <mat-card-subtitle>Дата рождения: {{coach.birthDate| date: 'dd.MM.yyyy'}}
                                </mat-card-subtitle>
                            </mat-card-header>
                            <mat-card-content style="margin-left: 17px">
                                <h5>Паспорт</h5>
                                <p *ngIf="coach.passportSeries && coach.passportNumber">
                                    Серия: {{coach.passportSeries}} Номер: {{coach.passportNumber}} <br>
                                    Выдан: <span matTooltip="{{coach.passportDesc}}"> {{coach.passportDesc.length > 20 ? coach.passportDesc.substring(0,20) + '...': coach.passportDesc}}</span>
                                </p>
                                <p *ngIf="!coach.passportSeries && !coach.passportNumber">
                                    Данных нет
                                </p>
                            </mat-card-content>
                            <mat-card-actions style="margin-left: 17px">
                                <button mat-stroked-button color="warn" (click)="removeCoach(i)">Удалить тренера
                                </button>
                            </mat-card-actions>
                        </mat-card>
                    </div>
                </div>
            </div>
        </div>

        <!-------------------------------Создание участников----------------------------------------------------------->
        <div id="tabContent_3" style="display: none">
            <h3>Добавьте участников</h3>
            <form class="example-container" [formGroup]="optionsMember" [style.fontSize.px]="getFontSize()" style="margin-bottom: 40px"
                  #memberForm="ngForm">
                <mat-form-field [color]="optionsMember.value.color">
                    <input matInput placeholder="ФИО участника" [(ngModel)]="currentMember.name" name="name" required
                           [formControl]="inpNameMember"
                    >
                    <mat-error *ngIf="inpNameMember.invalid">{{getInpNameMemberErrorMessage()}}</mat-error>
                </mat-form-field>
                <div>
                    <label style="font-size: 20px">Пол:</label>
                    <mat-radio-group [(ngModel)]="currentMember.gender" name="gender" [ngModelOptions]="{standalone: true}">
                        <mat-radio-button value="male">Мужской</mat-radio-button>
                        <mat-radio-button value="female">Женский</mat-radio-button>
                    </mat-radio-group>
                </div>
                <mat-form-field [color]="optionsMember.value.color">
                    <input matInput [matDatepicker]="pickerMember" (focus)="pickerMember.open()" readonly
                           placeholder="Дата рождения" [(ngModel)]="currentMember.birthDate" [max]="maxDate"
                           [formControl]="inpDateMember"
                           required>
                    <mat-datepicker-toggle matSuffix [for]="pickerMember"></mat-datepicker-toggle>
                    <mat-datepicker #pickerMember startView="multi-year"></mat-datepicker>
                    <mat-error *ngIf="inpDateMember.invalid">{{getInpDateMemberErrorMessage()}}</mat-error>
                </mat-form-field>
                <mat-form-field [color]="optionsMember.value.color">
                    <mat-select placeholder="Разряд" [(ngModel)]="currentMember.quality" required name="quality"
                                [formControl]="quality"
                    >
                        <mat-option *ngFor="let quality of qualities" [value]="quality">
                            {{quality}}
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="quality.invalid">{{getQualityErrorMessage()}}</mat-error>
                </mat-form-field>
                <h5>Паспорт</h5>
                <table class="example-full-width" cellspacing="0">
                    <tr>
                        <td>
                            <mat-form-field [color]="optionsMember.value.color">
                                <input matInput placeholder="Серия" [(ngModel)]="currentMember.passportSeries"
                                       [formControl]="passSeriesMember"
                                       name="passportSeries">
                                <mat-error *ngIf="passSeriesMember.invalid">{{getPassSeriesMemberErrorMessage()}}
                                </mat-error>
                            </mat-form-field>
                        </td>
                        <td>
                            <mat-form-field [color]="optionsMember.value.color">
                                <input matInput placeholder="Номер" [(ngModel)]="currentMember.passportNumber"
                                       [formControl]="passNumberMember"
                                       name="passportNumber">
                                <mat-error *ngIf="passNumberMember.invalid">{{getPassNumberMemberErrorMessage()}}
                                </mat-error>
                            </mat-form-field>
                        </td>
                    </tr>
                </table>
                <mat-form-field [color]="optionsMember.value.color">
                    <input matInput placeholder="Выдан" [(ngModel)]="currentMember.passportDesc"
                           name="passportDesc" [formControl]="inpPassDescMember"
                    >
                    <mat-error *ngIf="inpPassDescMember.invalid">{{getInpPassDescMemberErrorMessage()}}</mat-error>
                </mat-form-field>
                <h5>Свидетельство о рождении</h5>
                <mat-form-field [color]="optionsMember.value.color">
                    <input matInput placeholder="Номер" [(ngModel)]="currentMember.birthCertificateNumber"
                           name="birthCertificateNumber"
                           [formControl]="birthCertificateNumber"
                    >
                    <mat-error *ngIf="birthCertificateNumber.invalid">{{getInpBirthCertificateNumberErrorMessage()}}
                    </mat-error>
                </mat-form-field>
                <mat-form-field [color]="optionsMember.value.color">
                    <input matInput placeholder="Выдан" [(ngModel)]="currentMember.birthCertificateDesc"
                           name="birthCertificateDesc"
                           [formControl]="birthCertificateDesc"
                    >
                    <mat-error *ngIf="birthCertificateDesc.invalid">{{getInpBirthCertificateDescErrorMessage()}}
                    </mat-error>
                </mat-form-field>
                <button mat-stroked-button color="primary" type="submit"
                        [disabled]="inpNameMember.invalid ||
                        inpDateMember.invalid ||
                         passSeriesMember.invalid ||
                         passNumberMember.invalid ||
                         inpPassDescMember.invalid ||
                          quality.invalid ||
                        birthCertificateNumber.invalid ||
                        birthCertificateDesc.invalid"
                        (click)="addMember();">Добавить участника
                </button>
            </form>

            <!-------------------------------Созданные участники------------------------------------------------------->
            <div class="container" style="margin: 20px">
                <h4>Участники команды</h4>
                <div *ngIf="!command.members.length">
                    <mat-hint>Пока участники не добавлены</mat-hint>
                </div>
                <div *ngIf="command.members.length">
                    <div *ngFor="let member of command.members" class="coach-card">
                        <mat-card>
                            <mat-card-header>
                                <mat-card-title>Участник: {{member.name}}</mat-card-title>
                                <mat-card-subtitle>
                                    Пол: <span>{{member.gender === 'male' ? 'мужской' : 'женский'}}</span> <br>
                                    Дата рождения: <span>{{member.birthDate| date: 'dd.MM.yyyy'}}</span>  <br>
                                    Разряд: <span>{{member.quality}}</span>
                                </mat-card-subtitle>
                            </mat-card-header>
                            <mat-card-content style="margin-left: 17px">
                                <h5>Паспорт</h5>
                                <p *ngIf="member.passportSeries && member.passportNumber">
                                    Серия: {{member.passportSeries}} Номер: {{member.passportNumber}} <br>
                                    Выдан: <span matTooltip="{{member.passportDesc}}"> {{member.passportDesc.length > 20 ? member.passportDesc.substring(0,20) + '...': member.passportDesc}}</span>
                                </p>
                                <p *ngIf="!member.passportSeries && !member.passportNumber">
                                    Данных нет
                                </p>
                            </mat-card-content>
                            <mat-card-content style="margin-left: 17px">
                                <h5>Свидетельство</h5>
                                <p *ngIf="member.birthCertificateNumber && member.birthCertificateDesc">
                                    Номер: {{member.birthCertificateNumber}} <br>
                                    Выдан: <span matTooltip="{{member.birthCertificateDesc}}"> {{member.birthCertificateDesc.length > 20 ? member.birthCertificateDesc.substring(0,20) + '...': member.birthCertificateDesc}}</span>
                                </p>
                                <p *ngIf="!member.birthCertificateNumber && !member.birthCertificateDesc">
                                    Данных нет
                                </p>
                            </mat-card-content>
                            <mat-card-actions style="margin-left: 17px">
                                <button mat-stroked-button color="warn" (click)="removeMember(i)">Удалить
                                    участника
                                </button>
                            </mat-card-actions>
                        </mat-card>
                    </div>
                </div>
            </div>
        </div>

        <!-------------------------------Создание заявок--------------------------------------------------------------->
        <div id="tabContent_4" style="display: none">
            <h3>Заявки</h3>
            <div class="container" style="margin-left: 12px; margin-bottom: 40px;">
                <h4>Заполните поля и создайте заявку</h4>
                <mat-form-field [color]="optionsMain.value.color">
                    <input matInput placeholder="Название заявки" [(ngModel)]="currentCommandRequest.name" name="name" [ngModelOptions]="{standalone: true}">
                </mat-form-field>
                <br>
                <mat-form-field [color]="optionsMain.value.color">
                    <mat-select placeholder="Выберите категорию" [(ngModel)]="currentCommandRequest.ageCategory" name="ageCategory" [ngModelOptions]="{standalone: true}">
                        <mat-option *ngFor="let cat of categories" [value]="cat">
                            {{cat}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <br>
                <mat-form-field [color]="optionsMain.value.color">
                    <mat-select placeholder="Выберите номинацию" [(ngModel)]="currentCommandRequest.nomination" name="nomination" [ngModelOptions]="{standalone: true}">
                        <mat-option *ngFor="let nom of nominations" [value]="nom">
                            {{nom}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <div style="margin-bottom: 10px">
                    <td-file-upload #singleFileUpload [(ngModel)]="files"
                                    (select)="selectEvent($event)"
                                    (upload)="uploadEvent($event)"
                                    (cancel)="cancelEvent()">
                        <mat-icon>file_upload</mat-icon><span>{{ singleFileUpload.value?.name }}</span>
                        <ng-template td-file-input-label >
                            <mat-icon>attach_file</mat-icon>
                            <span>
                          Загрузите музыку
                          <span [hidden]="!singleFileUpload?.required">*</span>
                        </ng-template>
                    </td-file-upload>
                </div>
            </div>
            <div class="container" style="margin-left: 10px; margin-bottom: 40px" *ngIf="currentCommandRequest.ageCategory && currentCommandRequest.nomination">
                <div class="row">
                    <div class="col-xl-6">
                        <h5>Выберите {{getCountOfMembersByNomination(currentCommandRequest.nomination)}}</h5>
                        <mat-selection-list #mems (selectionChange)="onSelectionMember($event)">
                            <mat-list-option *ngFor="let member of command.members | membersFilter:currentCommandRequest.ageCategory" [value]='member'>
                                <h5 matLine> Имя: {{member.name}} </h5>
                                <p matLine> Пол: <span>{{member.gender === 'male' ? 'мужской' : 'женский'}}</span></p>
                                <p matLine> Дата рождения: <span>{{member.birthDate | date: 'dd.MM.yyyy'}} </span></p>
                                <p matLine> <span>{{member.quality}} </span></p>
                            </mat-list-option>
                        </mat-selection-list>
                        <mat-hint *ngIf="!command.members.length">Участники пока не добавлены</mat-hint>
                        <mat-hint *ngIf="(command.members.length && !mems) || (command.members.length && isMemsListEmpty(mems))">
                            Нет участников для данной категории
                        </mat-hint>
                    </div>
                    <div class="col-xl-6">
                        <h5>Выберите тренеров</h5>
                        <mat-selection-list #coachs (selectionChange)="onSelectionCoach($event)">
                            <mat-list-option *ngFor="let coach of command.coaches" [value]='coach'>
                                <h5 matLine> Имя: {{coach.name}} </h5>
                                <p matLine> Дата рождения: {{coach.birthDate | date: 'dd.MM.yyyy'}} </p>
                            </mat-list-option>
                        </mat-selection-list>
                        <mat-hint *ngIf="!command.coaches.length">Тренеры пока не добавлены</mat-hint>
                    </div>
                </div>
                <button mat-stroked-button type="submit"
                        [disabled]="
                        !currentCommandRequest.members.length ||
                        !currentCommandRequest.coaches.length ||
                        !isMembersAddedCorrect(currentCommandRequest.nomination, currentCommandRequest.members.length) ||
                        foundErrorMember"
                        (click)="addCommandRequest();singleFileUpload.cancel();" style="margin: 10px 0">
                    Добавить заявку
                </button>
                <div>
                    <mat-hint *ngIf="!currentCommandRequest.coaches.length">Добавьте хотя бы 1 тренера</mat-hint>
                    <br>
                    <mat-hint *ngIf="!isMembersAddedCorrect(currentCommandRequest.nomination, currentCommandRequest.members.length)">
                        {{getNominationError(currentCommandRequest.nomination)}}
                    </mat-hint>
                    <mat-error *ngIf="foundErrorMember">
                        Участник: {{foundErrorMember.name}} участвует более, чем в 3 заявках,<br>
                        замените его или удалите заявку.
                    </mat-error>
                </div>
            </div>

            <!-------------------------------Созданные заявки---------------------------------------------------------->
            <div class="container" style="margin-left: 10px; margin-bottom: 10px">
                <h4>Созданные заявки</h4>
                <mat-hint *ngIf="!command.requests.length">Созданный заявок пока нет</mat-hint>
                <mat-accordion>
                    <div class="row" *ngFor="let request of command.requests; let i = index" style="margin: 8px 0">
                        <div class="col-xl-9">
                            <mat-expansion-panel style="height: auto">
                                <mat-expansion-panel-header style="height: auto">
                                    <mat-panel-title style="align-self: center;">
                                        <h5>{{request.name ? request.name : 'Без названия'}}</h5>
                                    </mat-panel-title>
                                    <mat-panel-description *ngIf="request.name && request.name.length < 24">
                                        Номинация: {{request.nomination}} <br>
                                        Категория: {{request.ageCategory}}
                                    </mat-panel-description>
                                </mat-expansion-panel-header>
                              <!--  <div class="container" style="margin-bottom: 7px; padding-left: 6px;">
                                    <div style="font: 15px 'Roboto'">
                                        <span style="font-family: Roboto, monospace;
                                                     font-size: 15px;
                                                     font-weight: 400;
                                                     color: rgba(0, 0, 0, 0.54);"
                                              *ngIf="request.name && request.name.length > 24">Номинация: {{request.nomination}} <br></span>
                                        <span style="font-family: Roboto, monospace;
                                                     font-size: 15px;
                                                     font-weight: 400;
                                                     color: rgba(0, 0, 0, 0.54);"  *ngIf="request.name && request.name.length > 24">Категория: {{request.ageCategory}}  <br></span>
                                        <span style="font-family: Roboto, monospace;
                                                     font-size: 15px;
                                                     font-weight: 400;
                                                     color: rgba(0, 0, 0, 0.54);" >Музыкальный файл: {{request.music.name}}</span>
                                    </div>
                                </div>-->
                                <span style="font-family: Roboto, monospace;
                                                     font-size: 15px;
                                                     font-weight: 400;
                                                     color: rgba(0, 0, 0, 0.54); margin-bottom: 10px; margin-left: 12px" *ngIf="request.musicFileName">Музыкальный файл: <a href="/">{{request.musicFileName}}</a></span>
                                <div class="container">
                                    <h5>Тренеры</h5>
                                    <div *ngFor="let coach of request.coaches" style="margin: 10px 0;">
                                        <mat-card>
                                            <mat-card-header>
                                                <mat-card-title>Тренер: {{coach.name}}</mat-card-title>
                                                <mat-card-subtitle>Дата рождения: {{coach.birthDate| date: 'dd.MM.yyyy'}}
                                                </mat-card-subtitle>
                                            </mat-card-header>
                                        </mat-card>
                                    </div>
                                </div>
                                <div class="container">
                                    <h5>Участники</h5>
                                    <div *ngFor="let member of request.members" style="margin: 10px 0;">
                                        <mat-card>
                                            <mat-card-header>
                                                <mat-card-title>{{member.name}}</mat-card-title>
                                                <mat-card-subtitle>
                                                    Пол: <span>{{member.gender === 'male' ? 'мужской' : 'женский'}}</span> <br>
                                                    Дата рождения: <span>{{member.birthDate| date: 'dd.MM.yyyy'}}</span>  <br>
                                                    Разряд: <span>{{member.quality}}</span>
                                                </mat-card-subtitle>
                                            </mat-card-header>
                                        </mat-card>
                                    </div>
                                </div>
                            </mat-expansion-panel>
                        </div>
                        <div class="col-xl-2" style="align-self: center;">
                            <button mat-stroked-button color="warn" (click)="removeRequest(i)">Удалить заявку
                            </button>
                        </div>
                    </div>
                </mat-accordion>
            </div>
        </div>
    </div>
</div>
